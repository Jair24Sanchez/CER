<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportajes por Categoría - CER</title>
    <link rel="stylesheet" href="../report-events.css">
    <link rel="stylesheet" href="../blog-editor.css">
    <style>
        .categoria-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .categoria-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        .categoria-title {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .categoria-subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .categoria-breadcrumb {
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #666;
        }
        .categoria-breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }
        .categoria-breadcrumb a:hover {
            text-decoration: underline;
        }
        .reportajes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        .reportaje-card {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .reportaje-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .reportaje-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            line-height: 1.4;
        }
        .reportaje-content {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
            max-height: 120px;
            overflow: hidden;
            position: relative;
        }
        .reportaje-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, white);
        }
        .reportaje-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.85em;
            color: #888;
            border-top: 1px solid #f0f0f0;
            padding-top: 15px;
        }
        .meta-badge {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        .meta-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .no-reportajes {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 60px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px dashed #dee2e6;
        }
        .no-reportajes h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .no-reportajes p {
            margin-bottom: 20px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            flex: 1;
            min-width: 120px;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header class="main-header">
        <a href="../Homepage.html" class="logo-link">
            <img src="../cer-logo.png" alt="CER Logo" class="logo">
        </a>
        <div class="header-buttons">
            <button class="create-btn">CREATE</button>
            <button class="login-btn">LOGIN</button>
        </div>
    </header>

    <main class="categoria-container">
        <div class="categoria-breadcrumb">
            <a href="../Homepage.html">Inicio</a> > 
            <a href="../reporte-por-iniciativa-propia.html">Crear Reportaje</a> > 
            <span id="breadcrumbCurrent">Categoría</span>
        </div>

        <div class="categoria-header">
            <h1 class="categoria-title" id="categoriaTitle">Cargando...</h1>
            <p class="categoria-subtitle" id="categoriaSubtitle">Cargando información...</p>
        </div>

        <div class="stats" id="stats">
            <div class="stat-item">
                <div class="stat-number" id="totalReportajes">0</div>
                <div class="stat-label">Total Reportajes</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="reportajesEsteMes">0</div>
                <div class="stat-label">Este Mes</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ultimoReportaje">-</div>
                <div class="stat-label">Último Reportaje</div>
            </div>
        </div>

        <div class="filters">
            <select id="sortBy" class="filter-select">
                <option value="newest">Más Recientes</option>
                <option value="oldest">Más Antiguos</option>
                <option value="title">Por Título</option>
            </select>
            <select id="filterBy" class="filter-select">
                <option value="all">Todos</option>
                <option value="thisMonth">Este Mes</option>
                <option value="thisWeek">Esta Semana</option>
            </select>
        </div>

        <div class="reportajes-grid" id="reportajesGrid">
            <div class="no-reportajes">
                <h3>Cargando reportajes...</h3>
                <p>Por favor espera mientras cargamos el contenido.</p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Obtener parámetros de la URL
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type');
            const subtype = urlParams.get('subtype');
            
            if (!type || !subtype) {
                // Redirigir a página de error si no hay parámetros
                window.location.href = '../Homepage.html';
                return;
            }
            
            // Cargar reportajes desde localStorage
            const reportajes = JSON.parse(localStorage.getItem('reportajes') || '[]');
            const categoriaReportajes = reportajes.filter(r => 
                r.type === type && r.subtype === subtype
            );
            
            // Configurar información de la categoría
            setupCategoriaInfo(type, subtype);
            
            // Mostrar estadísticas
            showStats(categoriaReportajes);
            
            // Mostrar reportajes
            showReportajes(categoriaReportajes);
            
            // Configurar filtros
            setupFilters(categoriaReportajes);
        });
        
        function setupCategoriaInfo(type, subtype) {
            const typeLabel = type === 'irl' ? 'IRL Events' : 'Digital Events';
            const subtypeLabel = getSubtypeLabel(type, subtype);
            
            document.getElementById('categoriaTitle').textContent = `${typeLabel} - ${subtypeLabel}`;
            document.getElementById('categoriaSubtitle').textContent = 
                type === 'irl' 
                    ? `Historias y reportajes de eventos presenciales en ${subtypeLabel}`
                    : `Historias y reportajes de eventos digitales en ${subtypeLabel}`;
            document.getElementById('breadcrumbCurrent').textContent = `${typeLabel} - ${subtypeLabel}`;
        }
        
        function getSubtypeLabel(type, subtype) {
            if (type === 'irl') {
                // Buscar en lista de países
                const country = window.countriesList?.find(c => c.code.toLowerCase() === subtype);
                return country ? country.name : subtype.toUpperCase();
            } else {
                // Buscar en lista de idiomas
                const language = window.languagesList?.find(l => l.code === subtype);
                return language ? language.name : subtype.toUpperCase();
            }
        }
        
        function showStats(reportajes) {
            const total = reportajes.length;
            const esteMes = reportajes.filter(r => {
                const fecha = new Date(r.timestamp);
                const ahora = new Date();
                return fecha.getMonth() === ahora.getMonth() && fecha.getFullYear() === ahora.getFullYear();
            }).length;
            
            const ultimoReportaje = reportajes.length > 0 
                ? new Date(Math.max(...reportajes.map(r => new Date(r.timestamp)))).toLocaleDateString()
                : '-';
            
            document.getElementById('totalReportajes').textContent = total;
            document.getElementById('reportajesEsteMes').textContent = esteMes;
            document.getElementById('ultimoReportaje').textContent = ultimoReportaje;
        }
        
        function showReportajes(reportajes, sortBy = 'newest') {
            const grid = document.getElementById('reportajesGrid');
            
            if (reportajes.length === 0) {
                grid.innerHTML = `
                    <div class="no-reportajes">
                        <h3>No hay reportajes disponibles</h3>
                        <p>Aún no hay reportajes en esta categoría.</p>
                        <a href="../reporte-por-iniciativa-propia.html" class="btn btn-primary">
                            📝 Crear el Primero
                        </a>
                    </div>
                `;
                return;
            }
            
            // Ordenar reportajes
            const sortedReportajes = [...reportajes].sort((a, b) => {
                switch (sortBy) {
                    case 'newest':
                        return new Date(b.timestamp) - new Date(a.timestamp);
                    case 'oldest':
                        return new Date(a.timestamp) - new Date(b.timestamp);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    default:
                        return 0;
                }
            });
            
            grid.innerHTML = sortedReportajes.map(reportaje => `
                <div class="reportaje-card" onclick="window.location.href='./leer.html?id=${reportaje.id}'" style="cursor: pointer;">
                    <div class="reportaje-title">${reportaje.title}</div>
                    <div class="reportaje-content">${reportaje.content}</div>
                    <div class="reportaje-meta">
                        <span class="meta-badge">${reportaje.typeLabel}</span>
                        <span class="meta-badge">${reportaje.subtypeLabel}</span>
                        <div class="meta-date">
                            <span>📅</span>
                            <span>${new Date(reportaje.timestamp).toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function setupFilters(reportajes) {
            const sortSelect = document.getElementById('sortBy');
            const filterSelect = document.getElementById('filterBy');
            
            sortSelect.addEventListener('change', (e) => {
                showReportajes(reportajes, e.target.value);
            });
            
            filterSelect.addEventListener('change', (e) => {
                let filteredReportajes = [...reportajes];
                
                switch (e.target.value) {
                    case 'thisMonth':
                        filteredReportajes = reportajes.filter(r => {
                            const fecha = new Date(r.timestamp);
                            const ahora = new Date();
                            return fecha.getMonth() === ahora.getMonth() && fecha.getFullYear() === ahora.getFullYear();
                        });
                        break;
                    case 'thisWeek':
                        filteredReportajes = reportajes.filter(r => {
                            const fecha = new Date(r.timestamp);
                            const ahora = new Date();
                            const diffTime = Math.abs(ahora - fecha);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            return diffDays <= 7;
                        });
                        break;
                }
                
                showReportajes(filteredReportajes, sortSelect.value);
            });
        }
    </script>
    
    <!-- Cargar listas de países e idiomas -->
    <script src="../js/countries-list.js"></script>
    <script src="../js/languages-list.js"></script>
</body>
</html>
